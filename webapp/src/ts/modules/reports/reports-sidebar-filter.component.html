<section class="sidebar-filter">
  <button (click)="openSidebarFilter()">open filters</button>

  <ng-container *ngIf="isFilterOpen">
    <div class="sidebar-backdrop" (click)="closeSidebarFilter()"></div>

    <div class="sidebar-main">
      <div class="sidebar-header">
        <p class="sidebar-title">{{ 'reports.sidebar.filter.title' | translate }}</p>
        <a class="sidebar-close fa fa-times" (click)="closeSidebarFilter()"></a>
      </div>

      <div class="sidebar-body">
        <accordion [closeOthers]="isMobile" [isAnimated]="true">
          <!-- 1. Form Type -->
          <accordion-group>
            <ng-container
              accordion-heading
              [ngTemplateOutlet]="headerTemplate"
              [ngTemplateOutletContext]="{ numSelected: 5, label: 'reports.sidebar.filter.form_type' }">
            </ng-container>
            <mm-form-type-filter
              class="filter"
              (search)="applyFilters()"
              [disabled]="disableFilter"
              [inline]="true">

            </mm-form-type-filter>
          </accordion-group>

          <!-- 2. Place -->
          <accordion-group>
            <ng-container
              accordion-heading
              [ngTemplateOutlet]="headerTemplate"
              [ngTemplateOutletContext]="{ numSelected: 4, label: 'reports.sidebar.filter.place' }">
            </ng-container>
            <mm-facility-filter
              class="filter"
              (search)="applyFilters()"
              [disabled]="disableFilter"
              [inline]="true">
            </mm-facility-filter>
          </accordion-group>

          <!-- 3. Date -->
          <accordion-group>
            <ng-container
              accordion-heading
              [ngTemplateOutlet]="headerTemplate"
              [ngTemplateOutletContext]="{ numSelected: 15, label: 'reports.sidebar.filter.date' }">
            </ng-container>
            <label>{{ 'reports.sidebar.filter.from_date' | translate }}</label>
            <mm-date-filter class="filter" (search)="applyFilters()" [disabled]="disableFilter" fieldId="from-date-filter" [isStartDate]="true"></mm-date-filter>
            <label>{{ 'reports.sidebar.filter.to_date' | translate }}</label>
            <mm-date-filter class="filter" (search)="applyFilters()" [disabled]="disableFilter" fieldId="to-date-filter"></mm-date-filter>
          </accordion-group>

          <!-- 4. Status -->
          <accordion-group>
            <ng-container
              accordion-heading
              [ngTemplateOutlet]="headerTemplate"
              [ngTemplateOutletContext]="{ numSelected: 25, label: 'reports.sidebar.filter.status' }">
            </ng-container>
            <mm-status-filter
              class="filter"
              (search)="applyFilters()"
              [disabled]="disableFilter"
              [inline]="true">
            </mm-status-filter>
          </accordion-group>
        </accordion>
      </div>

      <div class="sidebar-footer">
        <button type="button" class="btn btn-primary" (click)="closeSidebarFilter()">{{ 'reports.sidebar.filter.submit' | translate }}</button>
      </div>
    </div>
  </ng-container>
</section>

<ng-template #headerTemplate let-numSelected="numSelected" let-label="label">
  <button class="btn btn-link">
    <p class="title">{{ label | translate }}</p>
    <div class="chip" *ngIf="numSelected > 0">
      <span>{{ numSelected | translate }}</span>
      <span class="fa fa-times" (click)="clearSingleFilter(label); $event.stopPropagation();"></span>
    </div>
  </button>
</ng-template>
